<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{{ url_for('static', filename='favicon3.png') }}" type="image/png">
    <title>BitGene</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/litera/bootstrap.min.css" integrity="sha384-enpDwFISL6M3ZGZ50Tjo8m65q06uLVnyvkFO3rsoW0UC15ATBFz3QEhr3hmxpYsn" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">

</head>


<body>
<nav class="navbar navbar-expand-lg custom-navbar">
  <a class="navbar-brand" href="#">BitGene</a>

  <div class="collapse navbar-collapse justify-content-end">
    <div class="navbar-nav">
      {% if current_user.is_authenticated %}
        <span class="navbar-text mr-3">Hello, {{ current_user.username }}</span>
        <form action="{{ url_for('logout') }}" method="POST" class="d-inline">
          <button type="submit" class="btn btn-login ml-2">Logout</button>
        </form>
      {% else %}
    <!-- Register button triggers modal -->
      <button type="button" class="btn btn-login mr-2" data-toggle="modal" data-target="#loginModal">
        Login
      </button>
      <!-- Login button triggers modal -->
      <button type="button" class="btn btn-register" data-toggle="modal" data-target="#registerModal">
        Register
      </button>
      {% endif %}
    </div>
  </div>
</nav>

  <main class="container p-4">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} text-center mx-auto custom-flash" role="alert">
              {{ message }}
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}


    <h1 class="titulo text-center mt-4">BitGene</h1>
    <h4 class="text-center text-muted mb-4" style="font-weight: 400;">fast and simple genome exploration</h4>


    <div class="row align-items-center mb-5"> 
      <div class="col-8 offset-md-2 my-auto">
        <div class="card text-center">
          <div class="card-body">
            <h4 class="card-title">Upload your genome</h4>
            <p class="card-text text-normal">Supports FASTA format</p>

            <form action="/" method="POST" enctype="multipart/form-data">
              <div class="input-group mb-3">
                <input type="file" class="form-control" id="inputGroupFile02" name="genome_file" required>
              </div>
              <div class="d-grid gap-2 col-8 mx-auto">
                <button type="submit" class="btn btn-custom-upload btn-lg w-75">Upload</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      {% for card in data_cards %}
      {% if loop.index <= 4 %}
        <!-- First 4 cards: 4 per row = 12 / 4 = col-md-3 -->
        <div class="col-md-3 col-sm-6 mb-3">
      {% else %}
        <!-- Other cards: 12 / 3 = col-md-4 -->
        <div class="col-md-4 col-sm-6 mb-3">
      {% endif %}
          <div class="card custom-border mb-3 h-100">
            <div class="card-body text-center">
              <h4 class="card-title mt-1">{{ card.title }}</h4>
              <div style="
                background-color: {{ card.color }}; 
                color: {% if loop.index > 7%}white{% else %}black{% endif %};
                padding: 0.5rem 1rem; 
                border-radius: 0.25rem; 
                display: inline-block;">
                {% if card.url %}
                {% if card.is_button %}
                  <a href="{{ url_for('download_file', filename=card.url) }}" style="color: inherit; text-decoration: none;">Download</a>
                {% endif %}
                {% else %}
                  {{ card.value  | safe if card.value is not none else '-' }} {{ card.unit }}
                {% endif %}

              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  </main>


<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{{ url_for('login') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">User Login</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          
            <div class="form-group">
              <label for="username">Username</label>
              <input name="username" type="text" class="form-control" id="username" required>
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input name="password" type="password" class="form-control" id="password" required>
            </div>
            <p class="text-center mt-0 mb-0">
              Don't have an account? 
              <a href="#" class="modal-link" data-toggle="modal" data-target="#registerModal" data-dismiss="modal">Register here</a>
            </p>
            <!-- Show error message if wrong -->
            {% if error and show_login_modal %}
            <div class="custom-alert text-center">
              {{ error }}
            </div>
            {% endif %}
         
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-login">Login</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </form>
  </div>
</div>


<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="registerModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{{ url_for('register') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="registerModalLabel">Register</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
              <label for="register-username">Username</label>
              <input name="username" type="text" class="form-control" id="register-username" required>
            </div>
            <div class="form-group">
              <label for="register-email">E-mail</label>
              <input name="email" type="email" class="form-control" id="register-email" required>
            </div>
            <div class="form-group">
              <label for="register-password">Password</label>
              <input name="password" type="password" class="form-control" id="register-password" required>
            </div>
            <div class="form-group">
              <label for="confirm-password">Confirm password</label>
              <input name="confirm_password" type="password" class="form-control" id="confirm-password" required>
            </div>
            <p class="text-center mt-0 mb-0">
              Already registered? 
              <a href="#" class="modal-link" data-toggle="modal" data-target="#loginModal" data-dismiss="modal">Login here</a>
            </p>
            <!-- Show error message if wrong -->
            {% if error and show_register_modal %}
            <div class="custom-alert text-center">
              {{ error }}
            </div>
            {% endif %}
         
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-login">Register</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </form>
  </div>
</div>




<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

<!-- In case of error, show the login or register modal -->
{% if error and show_login_modal %}
  <script>
    $(document).ready(function(){
      $('#loginModal').modal('show');
    });
  </script>
{% endif %}

{% if error and show_register_modal %}
<script>
  $(document).ready(function(){
    $('#registerModal').modal('show');
  });
</script>
{% endif %}

</body>
</html>